# Note(å°ä¾¿ç­¾)

**æ¬¢è¿è®¿é—®æˆ‘çš„[ä¸ªäººåšå®¢](http://www.wensibo.top)**

ä¸€ç›´æƒ³è¦å†™ä¸€ä¸ªä¾¿ç­¾åº”ç”¨ï¼Œå› ä¸ºæˆ‘ä¸€ç›´åœ¨ç”¨çš„æ˜¯é”¤å­ä¾¿ç­¾å’Œä¸€åŠ ä¾¿ç­¾ï¼Œè§‰å¾—ä½“éªŒè¿˜æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯å§‹ç»ˆè§‰å¾—è‡ªå·±ä¹Ÿæ˜¯å¯ä»¥åšçš„ï¼Œè¿™æ®µæ—¶é—´å› ä¸ºæœ‰äº›äº‹æƒ…è€½è¯¯äº†ï¼Œé¡¹ç›®å‰å‡ å¤©åšå¥½äº†ï¼Œä¸€ç›´æ²¡æœ‰æ—¶é—´ä¸Šä¼ åˆ°[github](https://github.com/Wensibob/Note) (å„ä½å¤§çˆ·è·¯è¿‡ç»™ä¸ªstarå‘—ğŸ˜‰) ï¼Œä»Šå¤©è¶ç€æœ‰æ—¶é—´é¡ºä¾¿å†™äº†è¿™ç¯‡æ–‡ç« ï¼Œä»‹ç»ä¸€ä¸‹å†™è¿™ä¸ªä¾¿ç­¾æ—¶é‡åˆ°çš„ä¸€äº›é—®é¢˜ï¼Œå½“ä½œæ˜¯è·Ÿå¤§å®¶ä¸€èµ·åˆ†äº«å§ï¼


## åŠŸèƒ½
* å®ç°æœ€åŸºæœ¬çš„å¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹ä¾¿ç­¾
* ä¾¿ç­¾èƒ½å¤Ÿä¿å­˜åˆ°æœ¬åœ°
* ä¸»ç•Œé¢é‡‡ç”¨Material Designè®¾è®¡é£æ ¼ï¼Œç›¸å¯¹ç¾è§‚(å‹¿å–·)
* Recycle Viewä¸Šä¸‹æ»‘åŠ¨å¯ä»¥è‡ªåŠ¨éšè—Toolbar,ä»¥åŠFloating Action Button
* Recycle Viewçš„Itemå¯ä»¥å®ç°å¦‚QQçš„ä¾§æ»‘æ•ˆæœï¼Œå¯ä»¥é€šè¿‡ç‚¹å‡»åˆ é™¤ã€ç½®é¡¶è¿›è¡Œç¼–è¾‘
* å¯ä»¥è®¾ç½®ä¾¿ç­¾ä¸ºæ˜Ÿâœ¨ï¼Œé‚£ä¹ˆå°†ä¼šåœ¨ä¾¿ç­¾ç•Œé¢å·¦è¾¹å¢åŠ ä¸€ä¸ªçº¢è‰²çš„æ ‡å¿—ï¼Œä»¥æé†’ç”¨æˆ·æ­¤ä¾¿ç­¾ä¸ºé‡è¦ä¾¿ç­¾
* å˜è¿ä¸»ç•Œé¢æ ‡æœ‰æ—¶é—´ï¼Œå¹¶ä¸”æŒ‰ç…§ç¼–è¾‘æ—¶é—´ä»æ–°åˆ°æ—§è¿›è¡Œæ’åˆ—

## æ•ˆæœ
![æ•ˆæœå›¾](/screenshot/1.gif)

**Talk is cheap,show me your code**

## å¦‚ä½•åœ¨RecycleViewä¸­ä½¿ç”¨æœ¬åœ°Sqliteæ•°æ®åº“æ•°æ®
RecycleViewæ˜¯googleåœ¨æ¨å‡ºMaterial Designæ—¶ç€é‡ä»‹ç»çš„ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒå¯¹ä¼ ç»Ÿçš„ListViewå·²ç»å¯ä»¥è¯´æ˜¯å®Œå…¨ä»£æ›¿äº†ï¼ŒåŠŸèƒ½å¼ºå¤§æ˜¯ä»–çš„ä¸€ä¸ªæœ€å¤§ä¼˜ç‚¹ï¼Œä½†æ˜¯æœ‰ä¸€ç‚¹å±€é™çš„å°±æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„RecycleViewå¿…é¡»ç»§æ‰¿é‡å†™ RecyclerView.Adapter å’Œ RecyclerView.ViewHolderï¼Œè™½ç„¶åœ¨é‡Œé¢æˆ‘ä»¬å¯ä»¥éšæ„é‡å†™æ–¹æ³•ï¼Œä½†æ˜¯å¯ä»¥å‘ç°å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ•°æ®åº“ä½œä¸ºæ•°æ®æºï¼ŒRecyclerView.Adapteræ˜¯æ— æ³•æ”¯æŒè¯»å–Cursorçš„ï¼Œä½†æ˜¯å¼€æºçš„åŠ›é‡åˆå†æ¬¡æ˜¾ç°äº†ï¼Œç›´æ¥ç»™ä¸Š[githubåœ°å€](https://github.com/flzyup/ExRecyclerViewLibrary)ï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œåªéœ€è¦å¤ç”¨å…¶ä¸­çš„ä¸¤ä¸ªæ–‡ä»¶å°±è¡Œäº†ï¼Œå®¹æˆ‘å¨“å¨“é“æ¥ã€‚

**1ã€æ·»åŠ ä¸‹é¢çš„RecyclerViewCursorAdapter å’Œ CursorFilteråˆ°å·¥ç¨‹ä¸­**
ç”±äºä»£ç å¤ªé•¿å½±å“æ’ç‰ˆï¼Œæˆ‘å°±ç›´æ¥é™„ä¸Šä¸‹è½½é“¾æ¥
[RecyclerViewCursorAdapter](http://www.wensibo.top/file/img/2017-3-8Note/RecyclerViewCursorAdapter.java)
[CursorFilter](http://www.wensibo.top/file/img/2017-3-8Note/CursorFilter.java)

**2ã€æ–°å»ºè‡ªå®šä¹‰çš„Adapterå¹¶ä¸”ç»§æ‰¿RecyclerViewCursorAdapter**    
* NoteAdapter     

```java
public class NoteAdapter extends RecyclerViewCursorAdapter<NoteAdapter.MyNoteViewHolder> {

    private Context mContext;
    private RecyclerViewOnItemClickListener mOnItemClickListener;
    private onSwipeListener mOnSwipeListener;


    public NoteAdapter(Context context,Cursor cursor,int flags) {
        super(context,cursor,flags);
        this.mContext = context;
    }

    @Override
    public MyNoteViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {
        View root = LayoutInflater.from(parent.getContext()).inflate(R.layout.note_row, parent, false);
        MyNoteViewHolder holder = new MyNoteViewHolder(root);
        return holder;
    }

    @Override
    public void onBindViewHolder(final MyNoteViewHolder holder, Cursor cursor) {
        int position = cursor.getPosition();
        holder.tv.setText(cursor.getString(cursor.getColumnIndex(NoteDbAdapter.COL_CONTENT)));
        holder.tv_dateTime.setText(cursor.getString(cursor.getColumnIndex(NoteDbAdapter.COL_DATETIME)));
        holder.mRowtab.setBackgroundColor(cursor.getInt(cursor.getColumnIndex(NoteDbAdapter.COL_IMPORTANT)) == 1?
                mContext.getResources().getColor(R.color.colorAccent):mContext.getResources().getColor(android.R.color.white)
        );
        holder.root.setTag(position);

        holder.tv.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                if (mOnItemClickListener != null) {
                    mOnItemClickListener.onItemClickListener(view, holder.getAdapterPosition());
                }
            }
        });


    }

    @Override
    protected void onContentChanged() {

    }

    /** è®¾ç½®ç‚¹å‡»äº‹ä»¶ */
    public void setRecyclerViewOnItemClickListener(RecyclerViewOnItemClickListener onItemClickListener) {
        this.mOnItemClickListener = onItemClickListener;
    }

    public RecyclerViewOnItemClickListener getOnItemClickListener() {
        return mOnItemClickListener;
    }

    /** ç‚¹å‡»äº‹ä»¶æ¥å£ */
    public interface RecyclerViewOnItemClickListener {
        void onItemClickListener(View view, int position);
    }


    /**
     * å†…éƒ¨ç±»Holder
     */
    class MyNoteViewHolder extends RecyclerView.ViewHolder {
        private TextView tv;
        private TextView tv_dateTime;
        private View mRowtab;
        private Button btnTop;
        private Button btnDelete;
        private View root;

        public MyNoteViewHolder(View root) {
            super(root);
            this.root = root;
            tv = (TextView) root.findViewById(R.id.row_text);
            tv_dateTime = (TextView) root.findViewById(R.id.tv_note_time);
            mRowtab = root.findViewById(R.id.row_tab);
            btnTop = (Button) root.findViewById(R.id.btnTop);
            btnDelete = (Button) root.findViewById(R.id.btnDelete);
        }
    }

}
```
**3ã€åœ¨Activityä¸­è¿™æ ·ç”¨**
```java
mRecyclerView = (RecyclerView) findViewById(R.id.recycle_notes);
        mRecyclerView.setLayoutManager(new LinearLayoutManager(this));
        mCursor = mNoteDbAdapter.fetchAllNotes();
        mNoteAdapter = new NoteAdapter(this, mCursor, 0);
        Log.d(TAG, "mCursorçš„å¤§å°ä¸ºï¼š" + mCursor.getCount());

        //è®¾ç½®ç‚¹å‡»äº‹ä»¶
        mNoteAdapter.setRecyclerViewOnItemClickListener(new NoteAdapter.RecyclerViewOnItemClickListener() {
            @Override
            public void onItemClickListener(View view, int position) {
                if (mCursor == null || mCursor.isClosed()) {
                    if (mCursor == null) {
                        Log.d("NoteActivity", "newCursor is null");
                        Toast.makeText(NoteActivity.this, "newCursor is null", Toast.LENGTH_SHORT).show();
                    } else if (mCursor.isClosed()){
                        Log.d("NoteActivity", "newCursor is closed");
                        Toast.makeText(NoteActivity.this, "newCursor is null", Toast.LENGTH_SHORT).show();
                    }
                } else {
                    mCursor.moveToPosition(position);
                    String content = mCursor.getString(mCursor.getColumnIndex(NoteDbAdapter.COL_CONTENT));
                    int importtant = mCursor.getInt(mCursor.getColumnIndex(NoteDbAdapter.COL_IMPORTANT));
                    int id = mCursor.getInt(mCursor.getColumnIndex(NoteDbAdapter.COL_ID));
                    Log.d("NoteActivity", content + importtant);
                    Note clickNote = new Note(id, content, importtant);
                    Intent intent = new Intent();
                    intent.setClass(NoteActivity.this, NoteContentActivity.class);
                    Bundle bundle = new Bundle();
                    bundle.putSerializable("note", clickNote);
                    intent.putExtras(bundle);
                    startActivity(intent);
                }

            }
        });

        //è®¾ç½®é€‚é…å™¨
        mRecyclerView.setAdapter(mNoteAdapter);
```

## å¦‚ä½•åœ¨RecycleViewä¸Šä¸‹æ»‘åŠ¨æ—¶éšè—Toolbarå’ŒFABæŒ‰é’®
æ€è·¯å¾ˆç®€å•ï¼Œåªéœ€è¦è®°å½•RecycleViewå‘ä¸‹æ»‘åŠ¨(æ‰‹æŒ‡å‘ä¸Šæ»‘åŠ¨)æ—¶ç§»åŠ¨çš„è·ç¦»ï¼Œè¶…è¿‡ä¸€å®šèŒƒå›´æ—¶å°±ä¼šè°ƒç”¨Toolbarä»¥åŠFloating Action Buttonçš„animate().translationYæ–¹æ³•ï¼Œä»¤å…¶åœ¨Yè½´æ–¹å‘ä¸Šç§»åŠ¨ï¼Œå½“RecycleViewå‘ä¸Šæ»‘åŠ¨(æ‰‹æŒ‡å‘ä¸‹æ»‘åŠ¨)æ—¶åˆä¼šåè¿‡æ¥å›åˆ°åˆå§‹çŠ¶æ€ï¼Œå¹¶ä¸”å½“æ»‘åŠ¨åˆ°RecycleViewåº•éƒ¨æ—¶ä¼šå¼ºåˆ¶Toolbarå’ŒFABå›åˆ°åˆå§‹çŠ¶æ€ï¼Œä¸Šä»£ç ã€‚     
* HidingScrollListener

```java
public abstract class HidingScrollListener extends RecyclerView.OnScrollListener {

    private static final int HIDE_THRESHOLD = 20;
    private int scrolledDistance = 0;
    private boolean controlsVisible = true;
    private int mItemSize=0;

    public HidingScrollListener(int itemSize) {
        this.mItemSize = itemSize - 1;
    }

    /**
     *
     * @param recyclerView
     * @param dx æ¨ªå‘çš„æ»šåŠ¨è·ç¦»
     * @param dy çºµå‘çš„æ»šåŠ¨è·ç¦»
     *           è®°å½•çš„æ˜¯ä¸¤ä¸ªæ»šåŠ¨äº‹ä»¶ä¹‹é—´çš„åç§»é‡ï¼Œè€Œä¸æ˜¯æ€»çš„æ»šåŠ¨è·ç¦»ã€‚
     */
    @Override
    public void onScrolled(RecyclerView recyclerView, int dx, int dy) {
        super.onScrolled(recyclerView, dx, dy);
        int firstVisibleItem = ((LinearLayoutManager) recyclerView.getLayoutManager()).findFirstVisibleItemPosition();
        int lastVisibleItem = ((LinearLayoutManager) recyclerView.getLayoutManager()).findLastVisibleItemPosition();

        if (firstVisibleItem == 0||lastVisibleItem==mItemSize) {
            if (!controlsVisible) {
                onShow();
                controlsVisible = true;
            }
        }else{
            //å¦‚æœæ€»çš„æ»šåŠ¨è·ç¦»è¶…å¤šäº†ä¸€å®šå€¼
            // ï¼ˆè¿™ä¸ªå€¼å–å†³äºä½ è‡ªå·±çš„è®¾å®šï¼Œè¶Šå¤§ï¼Œéœ€è¦æ»‘åŠ¨çš„è·ç¦»è¶Šé•¿æ‰èƒ½æ˜¾ç¤ºæˆ–è€…éšè—ï¼‰ï¼Œ
            // æˆ‘ä»¬å°±æ ¹æ®å…¶æ–¹å‘æ˜¾ç¤ºæˆ–è€…éšè—Toolbarï¼ˆdy>0æ„å‘³ç€ä¸‹æ»šï¼Œdy<0æ„å‘³ç€ä¸Šæ»šï¼‰ã€‚
            if (scrolledDistance > HIDE_THRESHOLD && controlsVisible) {
                onHide();
                controlsVisible = false;
                scrolledDistance = 0;
            } else if (scrolledDistance < -HIDE_THRESHOLD && !controlsVisible) {
                onShow();
                scrolledDistance = 0;
                controlsVisible = true;
            }
        }
        //è®¡ç®—å‡ºæ»šåŠ¨çš„æ€»è·ç¦»ï¼ˆdeltasç›¸åŠ ï¼‰ï¼Œ
        // ä½†æ˜¯åªåœ¨Toolbaréšè—ä¸”ä¸Šæ»šæˆ–è€…Toolbaræœªéšè—ä¸”ä¸‹æ»šçš„æ—¶å€™
        if ((controlsVisible && dy > 0) || (!controlsVisible && dy < 0)) {
            scrolledDistance += dy;
        }
    }

    public abstract void onHide();
    public abstract void onShow();
}
```
åœ¨Avtivityä¸­ä½¿ç”¨å›æ‰æ–¹æ³•
```java
//ä¸ºrecycleviewè®¾ç½®æ»šåŠ¨ç›‘å¬å™¨
        mRecyclerView.setOnScrollListener(new HidingScrollListener(mCursor.getCount()) {
            @Override
            public void onHide() {
                hideView();
            }

            @Override
            public void onShow() {
                showView();
            }
        });

       private void hideView() {
        mToolbar.animate().translationY(
                -mToolbar.getHeight()).setInterpolator(new AccelerateInterpolator(2));
        FrameLayout.LayoutParams ip = (FrameLayout.LayoutParams) mFloatingActionButton.getLayoutParams();
        int fabButtonMargin = ip.bottomMargin;
        mFloatingActionButton.animate().translationY(
                mFloatingActionButton.getHeight() + fabButtonMargin).setInterpolator(new AccelerateInterpolator(2)).start();
	}

    private void showView() {
        mToolbar.animate().translationY(0).setInterpolator(new DecelerateInterpolator(2));
        mFloatingActionButton.animate().translationY(0).setInterpolator(new DecelerateInterpolator(2)).start();
    	}
```
**ç‰¹åˆ«æ³¨æ„å¸ƒå±€æ–‡ä»¶**
å¦‚æœä½ å‘ç°ä½ è¿è¡Œçš„æ•ˆæœåƒä¸‹é¢çš„æˆªå›¾ä¸€æ ·çš„è¯ï¼Œé‚£ä½ è‚¯å®šæ˜¯å› ä¸ºå¸ƒå±€æ–‡ä»¶ä¸Šå°‘å†™äº†è¿™ä¸¤å¥
```
android:clipToPadding="false"
android:paddingTop="?attr/actionBarSize"
```
![bugæˆªå›¾](/screenshot/2.png)    
å®Œæ•´çš„å¸ƒå±€ä»£ç å¦‚ä¸‹ï¼š   
* main_activity.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
             xmlns:app="http://schemas.android.com/apk/res-auto"
              android:layout_width="match_parent"
              android:layout_height="match_parent">

    <android.support.v7.widget.RecyclerView
        android:id="@+id/recycle_notes"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:clipToPadding="false"
        android:paddingTop="?attr/actionBarSize"
        />

    <android.support.v7.widget.Toolbar
        android:id="@+id/toolbar"
        android:layout_width="match_parent"
        android:layout_height="?attr/actionBarSize"
        android:background="?attr/colorPrimary"
        android:clipToPadding="false"
        app:titleTextColor="@android:color/white"
        />

    <android.support.design.widget.FloatingActionButton
        android:id="@+id/button_add_note"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_gravity="bottom|right"
        android:layout_marginBottom="16dp"
        android:layout_marginRight="16dp"
        android:src="@drawable/ic_action_new"
        android:elevation="15dp"
        app:fabSize="normal"
        app:pressedTranslationZ="8dp"
        app:rippleColor="#ff87eb"
        />

</FrameLayout>
```
## æœ€åæ¥è®²è®²å¦‚ä½•å®ç°ä»¿QQçš„ä¾§æ»‘å‡ºç°åˆ é™¤ã€æŒ‡å®šæ“ä½œ
é¦–å…ˆå¾—è°¢è°¢[å¼ æ—­ç«¥](http://blog.csdn.net/zxt0601/article/details/53157090) ,ä»–çš„ä¸€ä¸ªåº“å¸®æˆ‘è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œ[ç‚¹å‡»è¿™é‡Œ](https://github.com/mcxtzhang/SwipeDelMenuLayout)å¯ä»¥è®¿é—®ä»–çš„é¡¹ç›®ã€‚    
**1ã€åœ¨å¸ƒå±€æ–‡ä»¶ä¸­ä½¿ç”¨`com.mcxtzhang.swipemenulib.SwipeMenuLayout`å¸ƒå±€ï¼Œåœ¨ItemViewåæ·»åŠ buttonè¡¨ç¤ºåˆ é™¤ç½®é¡¶æŒ‰é’®ã€‚**    
**2ã€åœ¨Adapterä¸­è®¾ç½®æ‰“å¼€ä¾§æ»‘èœå•ï¼Œå¹¶ä¸”å¯ä»¥è®¾ç½®èœå•åœ¨å·¦è¿˜æ˜¯åœ¨å³**      
```java
((SwipeMenuLayout) holder.root.findViewById(R.id.swipeMenuLayout)).setIos(false).setLeftSwipe(false).setSwipeEnable(true);
```
**3ã€åœ¨Activityä¸­è®¾ç½®åŠ¨ä½œäº‹ä»¶**
```java
 mNoteAdapter.setOnSwipeListener(new NoteAdapter.onSwipeListener() {
            @Override
            public void onDel(int pos) {
                Toast.makeText(NoteActivity.this, "ç‚¹å‡»äº†ç¬¬" + (pos+1) + "æ¡itemçš„åˆ é™¤æŒ‰é’®", Toast.LENGTH_SHORT).show();
                mCursor.moveToPosition(pos);
                int id = mCursor.getInt(mCursor.getColumnIndex(NoteDbAdapter.COL_ID));
                mNoteDbAdapter.deleteNoteById(id);
                mCursor = mNoteDbAdapter.fetchAllNotes();
                mNoteAdapter.changeCursor(mCursor);
            }

            @Override
            public void onTop(int pos) {
                Toast.makeText(NoteActivity.this, "ç‚¹å‡»äº†ç¬¬" + (pos+1) + "æ¡itemçš„TopæŒ‰é’®", Toast.LENGTH_SHORT).show();
                mCursor.moveToPosition(pos);
                int id = mCursor.getInt(mCursor.getColumnIndex(NoteDbAdapter.COL_ID));
                Note editNote = mNoteDbAdapter.fetchNoteById(id);
                editNote.setDateTime(DateUtil.formatDateTime());
                mNoteDbAdapter.updateNote(editNote);
                mCursor = mNoteDbAdapter.fetchAllNotes();
                mNoteAdapter.changeCursor(mCursor);
            }
        });
```

**å¤§åŠŸå‘Šæˆï¼Œå¦‚æœæƒ³è¦çœ‹è¯¦ç»†ä»£ç ï¼Œæˆ–è€…æœ‰ä»€ä¹ˆå»ºè®®å¯ä»¥åˆ°[Github](https://github.com/Wensibob/Note)ä¸Šç»™æˆ‘å‘Issueæˆ–è€…ç›´æ¥åœ¨ç«™å†…ç»™æˆ‘ç•™è¨€å“¦ï¼Œè®°å¾—starå“¦**

